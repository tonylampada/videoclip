(function(){"use strict";var t={638:function(t,e,i){var n=i(7195),r=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("VideoClip")],1)},o=[],s=function(){var t=this,e=t._self._c;return e("div",[e("video",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"video",attrs:{width:"400",controls:""}},[e("source",{attrs:{src:t.video_source,id:"video_here"}})]),e("input",{staticClass:"file_multi_video",attrs:{type:"file",name:"file[]",accept:"video/*"},on:{change:t.onSelectFile}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.textPrompt,expression:"textPrompt"}],attrs:{type:"text",name:"textInput"},domProps:{value:t.textPrompt},on:{input:function(e){e.target.composing||(t.textPrompt=e.target.value)}}}),e("button",{on:{click:t.buttonHandler}},[t._v("Show CLIP Similarity")]),e("div",t._l(t.img_srcs,(function(i,n){return e("div",{key:n,staticStyle:{display:"inline-block"}},[e("img",{style:{opacity:t.image_opacity[n]},attrs:{width:"150",height:"100",src:i}}),e("p",[t._v(t._s(n)+": "+t._s(t.img_similarities[n])+" ")])])})),0)])},a=[],c=(i(7658),i(7340)),u=i(19);async function l(t){const e=t,i={image:e},n="https://clip-featurize-esrwrrt7ma-uc.a.run.app/predict";return u.Z.post(n,i).then((t=>t.data.feature_vector))}async function d(t){const e={text:t},i="https://clip-featurize-esrwrrt7ma-uc.a.run.app/predict";return u.Z.post(i,e).then((t=>t.data.feature_vector))}function m(t,e){let i=0,n=0,r=0;for(let o=0;o<t.length;o++)i+=t[o]*e[o],n+=Math.pow(t[o],2),r+=Math.pow(e[o],2);return i/Math.sqrt(n*r)}var p={name:"VideoClip",data(){return{video_source:"",img_srcs:[],img_embeddings:[],img_similarities:[],image_opacity:[],textPrompt:"",textEmbedding:[]}},methods:{onSelectFile(t){this.video_source=URL.createObjectURL(t.target.files[0]),this.$refs.video.load()},async buttonHandler(){console.log(this.textPrompt),this.textEmbedding=await d(this.textPrompt),this.computeSimilarity()},computeSimilarity(){console.log("similarity sanity check:",m(this.textEmbedding,this.textEmbedding));const t=[];for(var e=0;e<this.img_embeddings.length;e++)t[e]=m(this.img_embeddings[e],this.textEmbedding);this.img_similarities=t,console.log("done computing similarity");const i=Math.min(...t),n=Math.max(...t);for(let r=0;r<t.length;r++)this.image_opacity[r]=(t[r]-i)/(n-i)},load_image(){const t="jpeg",e=.92;var i=document.createElement("CANVAS");const n=this.$refs.video;i.width=336,i.height=336,i.getContext("2d").drawImage(n,0,0,336,336);var r=i.toDataURL("image/"+t,e);this.img_srcs.push(r)}},mounted(){let t=0,e=0;const i=this,n=100;async function r(){await c.ZP.eachOfLimit(i.img_srcs,100,(async function(t,e){const n=await l(t);i.img_embeddings[e]=n})),console.log("done")}function o(){i.$refs.video.currentTime+=t/n,e+=1}this.$refs.video.addEventListener("loadeddata",(()=>{t=this.$refs.video.duration,o()})),this.$refs.video.addEventListener("seeked",(()=>{this.load_image(),e<n?o():r()})),window.COMP=this}},f=p,h=i(1001),v=(0,h.Z)(f,s,a,!1,null,null,null),g=v.exports,_={name:"App",components:{VideoClip:g}},y=_,b=(0,h.Z)(y,r,o,!1,null,null,null),w=b.exports;n.ZP.config.productionTip=!1,new n.ZP({render:t=>t(w)}).$mount("#app")}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.m=t,function(){var t=[];i.O=function(e,n,r,o){if(!n){var s=1/0;for(l=0;l<t.length;l++){n=t[l][0],r=t[l][1],o=t[l][2];for(var a=!0,c=0;c<n.length;c++)(!1&o||s>=o)&&Object.keys(i.O).every((function(t){return i.O[t](n[c])}))?n.splice(c--,1):(a=!1,o<s&&(s=o));if(a){t.splice(l--,1);var u=r();void 0!==u&&(e=u)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[n,r,o]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,o,s=n[0],a=n[1],c=n[2],u=0;if(s.some((function(e){return 0!==t[e]}))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(c)var l=c(i)}for(e&&e(n);u<s.length;u++)o=s[u],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(l)},n=self["webpackChunkvueclip"]=self["webpackChunkvueclip"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[998],(function(){return i(638)}));n=i.O(n)})();
//# sourceMappingURL=app.1aff8d5d.js.map